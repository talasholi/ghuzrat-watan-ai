<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØµÙ…Ù‘Ù… Ø«ÙˆØ¨Ùƒ Ø¨Ø§Ù„ØªØ·Ø±ÙŠØ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f6f2ff;
      color: #1f1235;
      direction: rtl;
      text-align: right;
      padding: 32px 16px;
    }

    .wrapper {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 18px 60px rgba(31, 18, 53, 0.08);
      padding: 32px 24px 28px;
    }

    @media (min-width: 720px) {
      .wrapper {
        padding: 40px 40px 32px;
      }
    }

    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: space-between;
    }

    .title {
      font-size: 1.7rem;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #381460;
    }

    .title-icon {
      font-size: 1.6rem;
    }

    .hint {
      font-size: 0.9rem;
      color: #7b7b9c;
      margin-bottom: 16px;
    }

    .label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 12px;
    }

    .label-row span {
      font-weight: 600;
      font-size: 0.95rem;
      color: #40325a;
    }

    .char-counter {
      font-size: 0.8rem;
      color: #9991b8;
    }

    textarea {
      width: 100%;
      min-height: 140px;
      resize: vertical;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid #e0d6ff;
      font-size: 0.98rem;
      line-height: 1.8;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
      background: #fbf9ff;
    }

    textarea:focus {
      border-color: #7c3aed;
      box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.08);
      background: #ffffff;
    }

    textarea::placeholder {
      color: #b4a8dd;
    }

    .actions {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin-top: 14px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .generate-btn {
      border: none;
      outline: none;
      border-radius: 999px;
      padding: 10px 26px;
      background: linear-gradient(135deg, #ec4899, #8b5cf6);
      color: #ffffff;
      font-weight: 700;
      font-size: 0.98rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.35);
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s;
    }

    .generate-btn:disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .generate-btn:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 13px 30px rgba(139, 92, 246, 0.4);
    }

    .loading-dot {
      width: 5px;
      height: 5px;
      background: #fff;
      border-radius: 50%;
      animation: blink 0.9s infinite alternate;
    }

    @keyframes blink {
      from { opacity: 0.3; transform: translateY(1px); }
      to   { opacity: 1;   transform: translateY(-1px); }
    }

    .status-text {
      font-size: 0.86rem;
      color: #9186c8;
    }

    .error-box {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #b91c1c;
      font-size: 0.9rem;
      display: none;
      align-items: center;
      gap: 6px;
    }

    .error-box strong {
      font-size: 1.1rem;
    }

    .preview {
      margin-top: 24px;
      border-top: 1px dashed #e4ddff;
      padding-top: 20px;
    }

    .preview-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #554271;
      margin-bottom: 10px;
    }

    .preview-inner {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .image-wrapper {
      border-radius: 18px;
      background: linear-gradient(145deg, #f9f5ff, #fdfbff);
      border: 1px solid #e4ddff;
      padding: 10px;
      display: none;
    }

    .image-wrapper img {
      display: block;
      width: 100%;
      border-radius: 14px;
      background: #f1ebff;
    }

    .parsed-box {
      font-size: 0.85rem;
      color: #8175b5;
      background: #faf7ff;
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px dashed #ded3ff;
      white-space: pre-line;
    }

    .parsed-label {
      font-weight: 600;
      color: #5b4a94;
      margin-left: 4px;
    }
  </style>
</head>
<body>
  <main class="wrapper">
    <header class="header">
      <div class="title">
        <span class="title-icon">âœ¨</span>
        <span>ØµÙ…Ù‘Ù… Ø«ÙˆØ¨Ùƒ Ø¨Ø§Ù„ØªØ·Ø±ÙŠØ²</span>
      </div>
    </header>

    <p class="hint">
      Ø§ÙƒØªØ¨ÙŠ ÙˆØµÙØ§Ù‹ Ù„Ù„Ø«ÙˆØ¨ Ø§Ù„Ø°ÙŠ ØªØªØ®ÙŠÙ„ÙŠÙ‡ (Ø§Ù„Ù„ÙˆÙ†ØŒ Ù†ÙˆØ¹ Ø§Ù„ØªØ·Ø±ÙŠØ²ØŒ Ø·ÙˆÙ„ Ø§Ù„Ø£ÙƒÙ…Ø§Ù…ØŒ ØªÙØ§ØµÙŠÙ„ Ù…Ù…ÙŠÙ‘Ø²Ø©â€¦)
      Ø«Ù… Ø§Ø¶ØºØ·ÙŠ <strong>Generate</strong> Ù„Ù†ÙˆÙ„Ù‘Ø¯ Ù„Ùƒ ØµÙˆØ±Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ©.
    </p>

    <form id="dress-form">
      <div class="label-row">
        <span>ÙˆØµÙ Ø§Ù„Ø«ÙˆØ¨</span>
        <span class="char-counter"><span id="char-count">0</span> / 400 Ø­Ø±Ù</span>
      </div>

      <textarea
        id="description"
        maxlength="400"
        placeholder="Ù…Ø«Ø§Ù„: Ø«ÙˆØ¨ ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† Ù…Ø·Ø±Ù‘Ø² Ø¨Ø®ÙŠÙˆØ· Ø°Ù‡Ø¨ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒÙ…Ø§Ù… ÙˆØ§Ù„ØµØ¯Ø±ØŒ Ù…Ø¹ ÙŠØ§Ù‚Ø© Ø¹Ù„Ù‰ Ø´ÙƒÙ„ V ÙˆØ®Ø·ÙˆØ· ØªØ±Ø§Ø«ÙŠØ© Ù…Ù† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø¯Ø³."></textarea>

      <div class="actions">
        <button type="submit" class="generate-btn" id="generate-btn">
          <span>Generate</span>
          <span class="loading-dot" id="loading-dot" style="display:none;"></span>
        </button>
        <div class="status-text" id="status-text">
          Ø¬Ø§Ù‡Ø² Ù„Ø¥Ù†Ø´Ø§Ø¡ ØªØµÙ…ÙŠÙ…Ùƒ ğŸŒŸ
        </div>
      </div>

      <div class="error-box" id="error-box">
        <strong>âœ–</strong>
        <span id="error-message"></span>
      </div>
    </form>

    <section class="preview">
      <div class="preview-title">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>

      <div class="preview-inner">
        <div class="image-wrapper" id="image-wrapper">
          <img id="dress-image" alt="ØµÙˆØ±Ø© Ø§Ù„Ø«ÙˆØ¨ Ø§Ù„Ù†Ø§ØªØ¬Ø© Ù…Ù† Ø§Ù„ÙˆØµÙ" />
        </div>

        <div class="parsed-box" id="parsed-box" style="display:none;">
          <span class="parsed-label">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØµÙ:</span>
          <span id="parsed-text"></span>
        </div>
      </div>
    </section>
  </main>

  <script>
    const form = document.getElementById('dress-form');
    const descriptionInput = document.getElementById('description');
    const charCountSpan = document.getElementById('char-count');
    const generateBtn = document.getElementById('generate-btn');
    const loadingDot = document.getElementById('loading-dot');
    const statusText = document.getElementById('status-text');
    const errorBox = document.getElementById('error-box');
    const errorMessage = document.getElementById('error-message');
    const imageWrapper = document.getElementById('image-wrapper');
    const dressImage = document.getElementById('dress-image');
    const parsedBox = document.getElementById('parsed-box');
    const parsedText = document.getElementById('parsed-text');

    function setLoading(isLoading) {
      if (isLoading) {
        generateBtn.disabled = true;
        loadingDot.style.display = 'inline-block';
        generateBtn.firstElementChild.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
        statusText.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù‡Ø°Ø§ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù...';
      } else {
        generateBtn.disabled = false;
        loadingDot.style.display = 'none';
        generateBtn.firstElementChild.textContent = 'Generate';
        statusText.textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ø¥Ù†Ø´Ø§Ø¡ ØªØµÙ…ÙŠÙ…Ùƒ ğŸŒŸ';
      }
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorBox.style.display = 'flex';
    }

    function clearError() {
      errorMessage.textContent = '';
      errorBox.style.display = 'none';
    }

    descriptionInput.addEventListener('input', () => {
      charCountSpan.textContent = descriptionInput.value.length.toString();
    });

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      clearError();
      imageWrapper.style.display = 'none';
      parsedBox.style.display = 'none';

      const description = descriptionInput.value.trim();

      if (!description) {
        showError('Ø£Ø±Ø¬ÙˆÙƒ Ø§ÙƒØªØ¨ÙŠ ÙˆØµÙØ§Ù‹ Ù„Ù„Ø«ÙˆØ¨ Ø£ÙˆÙ„Ø§Ù‹.');
        return;
      }

      setLoading(true);

      try {
        const response = await fetch('/api/gw/generate-dress', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ description })
        });

        let data;
        try {
          data = await response.json();
        } catch (parseErr) {
          console.error('Failed to parse JSON:', parseErr);
          showError('ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…. Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„.');
          return;
        }

        if (!response.ok) {
          console.error('Non-OK HTTP status:', response.status, data);
          showError(data && data.error ? data.error : 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©.');
          return;
        }

        if (data && data.ok === false) {
          // Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø±Ø¬Ø¹ ok:false Ù…Ø¹ Ø±Ø³Ø§Ù„Ø©
          showError(data.error || 'ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙˆØµÙ.');
          return;
        }

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯Ø© Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª
        const imageUrl =
          (data.image && data.image.url) ||
          data.image_url ||
          (Array.isArray(data.images) && data.images[0] && data.images[0].url) ||
          null;

        if (!imageUrl) {
          console.error('No image URL in response:', data);
          showError('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙˆØµÙØŒ Ø­Ø§ÙˆÙ„ÙŠ ØªØ¨Ø³ÙŠØ· Ø§Ù„ÙˆØµÙ Ø£Ùˆ ØªØºÙŠÙŠØ± Ø¨Ø¹Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª.');
          return;
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
        dressImage.src = imageUrl;
        imageWrapper.style.display = 'block';

        // Ù„Ùˆ ÙÙŠÙ‡ ØªØ­Ù„ÙŠÙ„ Ù„Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        if (data.parsed && data.parsed.raw_text) {
          parsedText.textContent = data.parsed.raw_text;
          parsedBox.style.display = 'block';
        } else if (data.description) {
          parsedText.textContent = data.description;
          parsedBox.style.display = 'block';
        } else {
          parsedBox.style.display = 'none';
        }

        statusText.textContent = 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØµÙÙƒ âœ…';
      } catch (err) {
        console.error('Request error:', err);
        showError('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
</html>
Add dress designer page
